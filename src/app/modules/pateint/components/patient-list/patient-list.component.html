<div class="bg-white datatable-table">
  <!-- <div class="title">
    <h3>Patients</h3>
  </div> -->


  <!-- <div class="lead-filter">
    <app-patient-filter [totalDataCount]="totalDataCount" (patientFilterEmitter)="onPatientFilterSelection($event)">
    </app-patient-filter>
  </div> -->
  <div class="title btnn">
    <h3>All Patients</h3>
    <div>
      <button class="btn-default-new btn-small-new btn-size" (click)="openImportModal()" style="margin-left: 10px;">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="20" height="20">
          <path d="M13 2.5V5C13 7.35702 13 8.53553 13.7322 9.26777C14.4645 10 15.643 10 18 10H22" stroke="#2656C9"
            stroke-width="1.5" />
          <path d="M8.5 13.5L8.5 18.5M8.5 18.5L10.5 16.625M8.5 18.5L6.5 16.625" stroke="#2656C9" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round" />
          <path
            d="M2.75 10C2.75 9.58579 2.41421 9.25 2 9.25C1.58579 9.25 1.25 9.58579 1.25 10H2.75ZM21.25 14C21.25 14.4142 21.5858 14.75 22 14.75C22.4142 14.75 22.75 14.4142 22.75 14H21.25ZM15.3929 4.05365L14.8912 4.61112L15.3929 4.05365ZM19.3517 7.61654L18.85 8.17402L19.3517 7.61654ZM21.654 10.1541L20.9689 10.4592V10.4592L21.654 10.1541ZM3.17157 20.8284L3.7019 20.2981H3.7019L3.17157 20.8284ZM20.8284 20.8284L20.2981 20.2981L20.2981 20.2981L20.8284 20.8284ZM1.35509 5.92658C1.31455 6.33881 1.61585 6.70585 2.02807 6.7464C2.4403 6.78695 2.80734 6.48564 2.84789 6.07342L1.35509 5.92658ZM22.6449 18.0734C22.6855 17.6612 22.3841 17.2941 21.9719 17.2536C21.5597 17.2131 21.1927 17.5144 21.1521 17.9266L22.6449 18.0734ZM14 21.25H10V22.75H14V21.25ZM2.75 14V10H1.25V14H2.75ZM21.25 13.5629V14H22.75V13.5629H21.25ZM14.8912 4.61112L18.85 8.17402L19.8534 7.05907L15.8947 3.49618L14.8912 4.61112ZM22.75 13.5629C22.75 11.8745 22.7651 10.8055 22.3391 9.84897L20.9689 10.4592C21.2349 11.0565 21.25 11.742 21.25 13.5629H22.75ZM18.85 8.17402C20.2034 9.3921 20.7029 9.86199 20.9689 10.4592L22.3391 9.84897C21.9131 8.89241 21.1084 8.18853 19.8534 7.05907L18.85 8.17402ZM10.0298 2.75C11.6116 2.75 12.2085 2.76158 12.7405 2.96573L13.2779 1.5653C12.4261 1.23842 11.498 1.25 10.0298 1.25V2.75ZM15.8947 3.49618C14.8087 2.51878 14.1297 1.89214 13.2779 1.5653L12.7405 2.96573C13.2727 3.16993 13.7215 3.55836 14.8912 4.61112L15.8947 3.49618ZM10 21.25C8.09318 21.25 6.73851 21.2484 5.71085 21.1102C4.70476 20.975 4.12511 20.7213 3.7019 20.2981L2.64124 21.3588C3.38961 22.1071 4.33855 22.4392 5.51098 22.5969C6.66182 22.7516 8.13558 22.75 10 22.75V21.25ZM1.25 14C1.25 15.8644 1.24841 17.3382 1.40313 18.489C1.56076 19.6614 1.89288 20.6104 2.64124 21.3588L3.7019 20.2981C3.27869 19.8749 3.02502 19.2952 2.88976 18.2892C2.75159 17.2615 2.75 15.9068 2.75 14H1.25ZM14 22.75C15.8644 22.75 17.3382 22.7516 18.489 22.5969C19.6614 22.4392 20.6104 22.1071 21.3588 21.3588L20.2981 20.2981C19.8749 20.7213 19.2952 20.975 18.2892 21.1102C17.2615 21.2484 15.9068 21.25 14 21.25V22.75ZM10.0298 1.25C8.15538 1.25 6.67442 1.24842 5.51887 1.40307C4.34232 1.56054 3.39019 1.8923 2.64124 2.64124L3.7019 3.7019C4.12453 3.27928 4.70596 3.02525 5.71785 2.88982C6.75075 2.75158 8.11311 2.75 10.0298 2.75V1.25ZM2.84789 6.07342C2.96931 4.83905 3.23045 4.17335 3.7019 3.7019L2.64124 2.64124C1.80633 3.47616 1.48944 4.56072 1.35509 5.92658L2.84789 6.07342ZM21.1521 17.9266C21.0307 19.1609 20.7695 19.8266 20.2981 20.2981L21.3588 21.3588C22.1937 20.5238 22.5106 19.4393 22.6449 18.0734L21.1521 17.9266Z"
            fill="#2656C9" />
        </svg>
        Import
      </button>
      <button class="btn-save-new btn-small-new" (click)="goToPaitent()">
        <i class="fa fa-plus"></i>
        Add New
      </button>
    </div>
  </div>

  <div class="table-list">
    <p-table #dt1 responsiveLayout="stack" [value]="rowData" [reorderableColumns]=true sortField="id" [sortOrder]="-1"
      [columns]="selectedColumns" [globalFilterFields]="globalFilterColumn" [(selection)]="selectedRows">
      <ng-template pTemplate="caption">
        <div class="caption-header flex align-items-center py-2">
          <div class="dropdown-wrap">
            
            <p-multiSelect  [resetFilterOnHide]="true" [options]="columns" [(ngModel)]="selectedColumns"
              optionLabel="header" selectedItemsLabel="{0} Columns" [style]="{minWidth: '120px'}"
              placeholder="Choose Columns">
            </p-multiSelect>
            <select #statusSelect (change)="filterByStatus(statusSelect.value)" class="form-select filter_dropdown mr-2"
              aria-label=".form-select-sm example">
              <option selected="true" disabled="disabled" value="">By Status</option>
              <option value="">All</option>
              <option value="NEW">New</option>
              <option value="EXISTING">Existing</option>
            </select>

            <p-multiSelect [resetFilterOnHide]="true" [maxSelectedLabels]="2" selectedItemsLabel="{0} Tags" [options]="leadTagsResponse"
            [(ngModel)]="leadTagFilter" (onChange)="onLeadtagChangeForMultiSelect($event)" optionLabel="name" optionValue="id"
            [style]="{minWidth: '120px'}" placeholder="Select Tag">
          </p-multiSelect>

             <!-- Filter by date -->

             <select style="width: 130px;margin: 0px 0px 0px 10px;cursor: pointer;" [(ngModel)]="activeDateFilter"
             class="form-select filter_dropdown" #Dateselect (change)="onDateFilter(Dateselect.value)">
             <option selected="true" disabled="disabled" value="">By Date</option>
             <option value="All">All</option>
             <option value="Today">Today</option>
             <option value="Yesterday">Yesterday</option>
             <option value="LastWeek">Last Week</option>
             <option value="LastMonth">Last Month</option>
             <option value="Between">Between</option>
             <option value="After">After</option>
             <option value="Before">Before</option>
           </select>

           <div class="date-fields">
             <ng-container *ngIf="activeDateFilter === 'Between'">
               <div class="d-flex align-items-center flex-row" style="position: relative; bottom: 8px;">
                 <div class="d-flex flex-column mr-2 ml-2">
                   <label for="startDate" style="font-size: 14px;margin-top: 10px;">Start Date:</label>
                   <input style="font-size: 12px; width: 130px;" type="date" class="form-control" id="startDate"
                     [(ngModel)]="startDate" [min]="minDate" (change)="onDateFilter('Between')"
                     [max]="endDate || maxDate" />
                 </div>
                 <div class="d-flex flex-column">
                   <label for="endDate" style="font-size: 14px;margin-top: 10px;">End Date:</label>
                   <input style="font-size: 12px; width: 130px;" type="date" class="form-control" id="endDate"
                     [(ngModel)]="endDate" (change)="onDateFilter('Between')" [min]="startDate || minDate"
                     [max]="maxDate" />
                 </div>
               </div>
             </ng-container>

             <ng-container *ngIf="activeDateFilter === 'After'">
               <div style="position: relative; bottom: 13px;" class="ml-2">
                 <label for="afterDate" style="font-size: 14px;margin-top: 10px;">Date After:</label>
                 <input style="font-size: 12px; width: 130px;" type="date" class="form-control" id="afterDate"
                   [(ngModel)]="afterDate" (change)="onDateFilter('After')" [min]="minDate" [max]="maxDate" />
               </div>
             </ng-container>

             <ng-container *ngIf="activeDateFilter === 'Before'">
               <div style="position: relative; bottom: 13px;" class="ml-2">
                 <label for="beforeDate" style="font-size: 14px;margin-top: 10px;">Date Before:</label>
                 <input style="font-size: 12px; width: 130px;" type="date" class="form-control" id="beforeDate"
                   [(ngModel)]="beforeDate" (change)="onDateFilter('Before')" [min]="minDate" [max]="maxDate" />
               </div>
             </ng-container>
           </div>
          </div>
          <span class="p-input-icon-left ml-auto"><i class="pi pi-search"></i>
            <div class="table-button">
              <input pInputText class="search-table" type="text" [(ngModel)]="searchText"
                (keyup.enter)="searchPatient()" placeholder="Search keyword" />
            </div>
            <span class="cross-icon" (click)="resetSearch()" *ngIf="searchText && searchText.length>0">
              <i class="pi pi-times"></i>
            </span>
          </span>
        </div>
        <ng-container *ngIf="selectedRows && selectedRows.length > 0">
          <div class="caption-footer d-flex justify-content-between align-items-center p-1 pb-0">
            <div class="row-selection">
              <span class="rows-selected-text">
                {{ selectedRows.length }} Items Selected
              </span>
              <span class="unselect-all-btn" (click)="unselectTriggers()">
                Unselect All
              </span>
            </div>

            <div class="selection-btn-wrapper">
              <span class="button export-btn" (click)="openExportFile()">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 18 16" fill="none">
                    <path
                      d="M17.1 6.9705C17.1 13.0455 15.0665 15.0705 8.99999 15.0705C2.9335 15.0705 0.899994 13.0455 0.899994 6.9705"
                      stroke="#333333" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M8.99908 1.20343V10.6975" stroke="#333333" stroke-linecap="round"
                      stroke-linejoin="round" />
                    <path d="M6.93878 2.93005L8.99894 0.92948L10.8524 2.78291" stroke="#333333" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                  Export
                </span>
              </span>

              <div class="dropdown d-flex align-items-center">
                <span class="button deleted-btn" id="dropdownMenuButton" data-bs-toggle="dropdown"
                  aria-expanded="false">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M20 8.25V18C20 21 18.21 22 16 22H8C5.79 22 4 21 4 18V8.25C4 5 5.79 4.25 8 4.25C8 4.87 8.24997 5.43 8.65997 5.84C9.06997 6.25 9.63 6.5 10.25 6.5H13.75C14.99 6.5 16 5.49 16 4.25C18.21 4.25 20 5 20 8.25Z"
                      stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    <path
                      d="M16 4.25C16 5.49 14.99 6.5 13.75 6.5H10.25C9.63 6.5 9.06997 6.25 8.65997 5.84C8.24997 5.43 8 4.87 8 4.25C8 3.01 9.01 2 10.25 2H13.75C14.37 2 14.93 2.25 15.34 2.66C15.75 3.07 16 3.63 16 4.25Z"
                      stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M8 13H12" stroke="#292D32" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                    <path d="M8 17H16" stroke="#292D32" stroke-width="1.5" stroke-linecap="round"
                      stroke-linejoin="round" />
                  </svg>
                  Update Status</span>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" (click)="updateLeadStatus('NEW')">New</a>
                  <a class="dropdown-item" (click)="updateLeadStatus('EXISTING')">Existing</a>
                </div>
              </div>


              <span class="button deleted-btn" (click)="addLeadTags()">
                <span>
                  <svg width="20" height="30" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M2 12C2 8.22876 2 6.34315 3.17157 5.17157C4.34315 4 6.22876 4 10 4H14C17.7712 4 19.6569 4 20.8284 5.17157C22 6.34315 22 8.22876 22 12V14C22 17.7712 22 19.6569 20.8284 20.8284C19.6569 22 17.7712 22 14 22H10C6.22876 22 4.34315 22 3.17157 20.8284C2 19.6569 2 17.7712 2 14V12Z"
                      stroke="#1C274C" stroke-width="1.5" />
                    <path d="M18 16L16 16M16 16L14 16M16 16L16 14M16 16L16 18" stroke="#1C274C" stroke-width="1.5"
                      stroke-linecap="round" />
                    <path d="M7 4V2.5" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round" />
                    <path d="M17 4V2.5" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round" />
                    <path d="M2.5 9H21.5" stroke="#1C274C" stroke-width="1.5" stroke-linecap="round" />
                  </svg>
                </span>
                Add Tags
              </span>

              <!-- ------------------------- Mass delete patient ------------------------- -->
              <span class="button deleted-btn" (click)="deleteAllSelectedTemplateModal(false)">
                <span>
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path
                      d="M17.5 5.60833C17.4833 5.60833 17.4583 5.60833 17.4333 5.60833C13.025 5.16667 8.62501 5 4.26667 5.44167L2.56667 5.60833C2.21667 5.64167 1.90834 5.39167 1.87501 5.04167C1.84167 4.69167 2.09167 4.39167 2.43334 4.35833L4.13334 4.19167C8.56667 3.74167 13.0583 3.91667 17.5583 4.35833C17.9 4.39167 18.15 4.7 18.1167 5.04167C18.0917 5.36667 17.8167 5.60833 17.5 5.60833Z"
                      fill="#333333" />
                    <path
                      d="M7.08334 4.76666C7.05 4.76666 7.01667 4.76666 6.975 4.75832C6.64167 4.69999 6.40834 4.37499 6.46667 4.04166L6.65 2.94999C6.78334 2.14999 6.96667 1.04166 8.90834 1.04166H11.0917C13.0417 1.04166 13.225 2.19166 13.35 2.95832L13.5333 4.04166C13.5917 4.38332 13.3583 4.70832 13.025 4.75832C12.6833 4.81666 12.3583 4.58332 12.3083 4.24999L12.125 3.16666C12.0083 2.44166 11.9833 2.29999 11.1 2.29999H8.91667C8.03334 2.29999 8.01667 2.41666 7.89167 3.15832L7.7 4.24166C7.65 4.54999 7.38334 4.76666 7.08334 4.76666Z"
                      fill="#333333" />
                    <path
                      d="M12.675 18.9583H7.325C4.41666 18.9583 4.3 17.35 4.20833 16.05L3.66666 7.65833C3.64166 7.31667 3.90833 7.01667 4.25 6.99167C4.6 6.975 4.89166 7.23334 4.91666 7.575L5.45833 15.9667C5.55 17.2333 5.58333 17.7083 7.325 17.7083H12.675C14.425 17.7083 14.4583 17.2333 14.5417 15.9667L15.0833 7.575C15.1083 7.23334 15.4083 6.975 15.75 6.99167C16.0917 7.01667 16.3583 7.30833 16.3333 7.65833L15.7917 16.05C15.7 17.35 15.5833 18.9583 12.675 18.9583Z"
                      fill="#333333" />
                    <path
                      d="M11.3833 14.375H8.60834C8.26667 14.375 7.98334 14.0917 7.98334 13.75C7.98334 13.4083 8.26667 13.125 8.60834 13.125H11.3833C11.725 13.125 12.0083 13.4083 12.0083 13.75C12.0083 14.0917 11.725 14.375 11.3833 14.375Z"
                      fill="#333333" />
                    <path
                      d="M12.0833 11.0417H7.91667C7.57501 11.0417 7.29167 10.7583 7.29167 10.4167C7.29167 10.075 7.57501 9.79166 7.91667 9.79166H12.0833C12.425 9.79166 12.7083 10.075 12.7083 10.4167C12.7083 10.7583 12.425 11.0417 12.0833 11.0417Z"
                      fill="#333333" />
                  </svg>
                </span>
                Delete
              </span>
            </div>
          </div>
        </ng-container>
      </ng-template>
      <ng-template pTemplate="header" let-columns>
        <tr class="head">
          <ng-container *ngFor="let col of columns">
            <ng-container *ngIf="col.field === 'Checkbox'; else headers">
              <th>
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
            </ng-container>
            <ng-template #headers>
              <th [pSortableColumn]="col.field">
                {{ col.header }}
                <p-sortIcon [field]="col.field"></p-sortIcon>
              </th>
            </ng-template>
          </ng-container>
        </tr>
      </ng-template>
      <!-- <ng-template pTemplate="body" let-data> -->
      <ng-template pTemplate="body" let-data let-columns="columns" let-rowIndex="rowIndex">
        <tr class="mobile-special">
          <ng-container *ngFor="let col of columns">
            <td>
              <ng-container [ngSwitch]="col.field">
                <ng-container *ngSwitchCase="'Checkbox'">
                  <p-tableCheckbox [value]="data" (onChange)="onRowSelect($event, data.id)"></p-tableCheckbox>
                </ng-container>
                <!-- ---------------------------- Status column ---------------------------- -->

                <ng-container *ngSwitchCase="'patientStatus'">
                  <span (click)="showPatientDetail(data.id)" class="click-edit allow-inline-edit"
                    *ngIf="!checkInlineEditCondition(rowIndex, col.field)"
                    (dblclick)="onDoubleClick(col.field, rowIndex, data)"> <span
                      class="p-column-title">{{col.header}}</span>
                    <app-patient-status-color-box [field]='"status"' [leadStatus]='data[col.field]'>
                    </app-patient-status-color-box>
                  </span>

                  <span *ngIf="checkInlineEditCondition(rowIndex, col.field)">
                    <select (blur)="onEditInlineLead()" (ngModelChange)="validateInput()" #inputFeild
                      class="form-control" [(ngModel)]="inlineEditLeadObj.patientStatus">
                      <option *ngFor="let status of LEADSTATUS" [ngValue]="status">{{status}}</option>

                    </select>
                  </span>
                </ng-container>

                <ng-container *ngSwitchCase="'fullName'">
                  <span class="p-column-title">{{col.header}}</span>

                  <span (click)="showPatientDetail(data.id)" class="click-edit allow-inline-edit"
                    *ngIf="!checkInlineEditCondition(rowIndex, col.field)"
                    (dblclick)="onDoubleClick(col.field, rowIndex, data)"> <span
                      class="p-column-title">{{col.header}}</span>
                    {{ data[col.field] ?? "-"}}</span>

                  <span *ngIf="checkInlineEditCondition(rowIndex, col.field)">
                    <input (blur)="onEditInlineLead()" #inputFeild (change)="validateInput()" class="form-control"
                      placeholder="Name" [(ngModel)]="inlineEditLeadObj.name" #name="ngModel"
                      [ngClass]="name.invalid && (name.dirty || name.touched)?'form-control is-invalid':'form-control'"
                      required>

                    <div *ngIf="name.invalid && (name.dirty || name.touched)" class="error">
                      <div *ngIf="name.errors?.required">
                        Name is required.
                      </div>

                    </div>
                  </span>
                </ng-container>

                <ng-container *ngSwitchCase="'actions'">
                  <span class="p-column-title">{{ col.header }}</span>
                  <button class="btn-invisible" mat-icon-button [matMenuTriggerFor]="menu"
                    aria-label="Example icon-button with a menu">
                    <i class="fa fa-ellipsis-v" aria-hidden="true"></i> </button>
                  <mat-menu #menu="matMenu">
                    <button (click)="editPatient(data.id)" mat-menu-item>Edit</button>
                    <button (click)="showPatientDetail(data.id);" mat-menu-item>View Details</button>
                    <button (click)="deleteTemplateModal(data, true)" mat-menu-item>Delete</button>
                  </mat-menu>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  <span class="click-edit" (click)="showPatientDetail(data.id)">
                    <span class="p-column-title">{{col.header}}</span> {{data[col.field] ? data[col.field] : '-'}}
                  </span>

                </ng-container>
              </ng-container>
            </td>
          </ng-container>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>


<!-- -------------------------- custom paginator --------------------------- -->
<p-paginator [rows]="paginatorConfig.noOfRecord" [totalRecords]="totalDataCount" (onPageChange)="paginate($event)"
  [showCurrentPageReport]="true" currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
  [rowsPerPageOptions]="paginatorConfig.recordArray" #patientPaginator></p-paginator>

<ng-container *ngIf="showImportModal">
  <app-import-file [isLead]="false" [isPatient]="true" [showImportModal]="showImportModal" [modalImportMessage]=null
    (modalImportClosed)="onCloseModal($event)"></app-import-file>
</ng-container>

<ng-container *ngIf="showModal">
  <app-delete-warning [modalData]="modalData" [showModal]="showModal" [modalMessage]="deleteModelMessage"
    (modalClosed)="onClosePatientModal($event)"></app-delete-warning>
</ng-container>


<ng-container *ngIf="showEditPatientModal">
  <app-edit-patient-modal [modalData]="patientId" [showModal]="showEditPatientModal"
    (modalClosed)="onCloseModalPatientModal($event)">
  </app-edit-patient-modal>
</ng-container>


<!-- -------------------------- export file --------------------------- -->
<ng-container *ngIf="showExportModal">
  <app-export-file [showExportModal]="showExportModal" [modalTitle]="'Export Patients'"
    [modalDescription]="'Select a file type you would like to Export in'" [modalExportMessage]=null
    (modalExportClosed)="onCloseExportFileModal($event)"></app-export-file>
</ng-container>

<ng-container *ngIf="showTagModal">
  <app-assign-tags [showLeadTagModal]="showTagModal" (modalTagClosed)="modalTagClosed($event)"
    [type]="'PATIENT'"></app-assign-tags>
</ng-container>